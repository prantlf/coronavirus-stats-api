#!/usr/bin/env node

const { ensureDatabase } = require('../lib/database')
const { updateAll } = require('../lib/updater')
const { getLastStatement } = require('../lib/database/engine')
const { ensureCountries } = require('../lib/countries')

async function main () {
  await Promise.all([ensureDatabase(), ensureCountries()])
  await updateAll()
}

main().catch(error => {
  const lastStatement = getLastStatement()
  process.stderr.write(`${lastStatement}\n${error.message}\n`)
  process.exit(3)
})
