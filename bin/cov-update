#!/usr/bin/env node

const { ensureDatabase } = require('../lib/database')
const { updateAll } = require('../lib/updater')
const { getLastLog } = require('../lib/database/engine')
const { ensureCountries } = require('../lib/countries')

async function main () {
  await Promise.all([ensureDatabase(), ensureCountries()])
  await updateAll()
}

main().catch(error => {
  const lastLog = getLastLog()
  process.stderr.write(`${lastLog}\n${error.message}\n`)
  process.exit(3)
})
