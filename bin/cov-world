#!/usr/bin/env node

const { createRange } = require('../lib/checks')
const { handleRequest } = require('../lib/handler')
const { printOutput } = require('../lib/formatter')
const { getLastStatement } = require('../lib/database/engine')

async function main () {
  const range = createRange(process.argv, 2)
  const output = await handleRequest({
    path: '/world',
    query: range
  })
  printOutput(output)
}

main().catch(error => {
  const lastStatement = getLastStatement()
  process.stderr.write(`${lastStatement}\n${error.message}\n`)
  process.exit(3)
})
